#!/bin/sh
PREREQ=""
prereqs() { echo "$PREREQ"; }
case $1 in
  prereqs) prereqs; exit 0;;
esac

# Detect plymouth rotation parameter from kernel command line
# Only volumio-adaptive theme uses this parameter
ROTATION=0

if grep -q "plymouth=90" /proc/cmdline 2>/dev/null; then ROTATION=90; fi
if grep -q "plymouth=180" /proc/cmdline 2>/dev/null; then ROTATION=180; fi
if grep -q "plymouth=270" /proc/cmdline 2>/dev/null; then ROTATION=270; fi

# Patch image theme (volumio-adaptive) - uses plymouth_rotation variable
ADAPTIVE_SCRIPT="/usr/share/plymouth/themes/volumio-adaptive/volumio-adaptive.script"
if [ -f "$ADAPTIVE_SCRIPT" ]; then
  sed -i "s/^plymouth_rotation = [0-9]*;/plymouth_rotation = ${ROTATION};/" "$ADAPTIVE_SCRIPT"
fi
